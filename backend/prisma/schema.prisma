// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ============================================
// USER MODEL
// ============================================
model User {
  id        Int     @id @default(autoincrement())
  email     String  @unique
  password  String  // bcrypt hashed
  name      String?
  
  // Relacje
  progress  Progress[]
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// ============================================
// PROGRESS MODEL - śledzenie postępów
// ============================================
model Progress {
  id        Int     @id @default(autoincrement())
  
  // Użytkownik
  userId    Int
  user      User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // Fiszki
  flashcardId Int?
  flashcardStatus String @default("new") // new, learning, mastered
  
  // Gry
  gameScore Int?
  gameAttempts Int @default(0)
  
  // Wideo
  videoId   Int?
  videoWatched Boolean @default(false)
  watchedMinutes Int @default(0)
  
  // Piosenki
  songId    Int?
  songListened Boolean @default(false)
  
  // Ogólnie
  type      String  // "flashcard", "game", "video", "song"
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@index([userId])
  @@index([type])
}

// ============================================
// FLASHCARD MODEL
// ============================================
model Flashcard {
  id        Int     @id @default(autoincrement())
  word      String
  translation String
  example   String?
  difficulty Int @default(1) // 1-3
  
  createdAt DateTime @default(now())
}

// ============================================
// GAME MODEL
// ============================================
model GameScore {
  id        Int     @id @default(autoincrement())
  userId    Int
  score     Int
  maxScore  Int
  
  createdAt DateTime @default(now())
}

// ============================================
// STATISTICS MODEL
// ============================================
model UserStats {
  id              Int     @id @default(autoincrement())
  userId          Int     @unique
  
  totalFlashcards Int @default(0)
  masteredFlashcards Int @default(0)
  learningFlashcards Int @default(0)
  
  totalGameScore  Int @default(0)
  gamesPlayed     Int @default(0)
  
  videosWatched   Int @default(0)
  totalWatchedMinutes Int @default(0)
  
  streak          Int @default(0)
  lastActivityDate DateTime?
  
  updatedAt DateTime @updatedAt
}
